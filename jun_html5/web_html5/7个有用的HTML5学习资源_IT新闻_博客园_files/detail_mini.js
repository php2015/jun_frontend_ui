function doComment(){var t=$.trim($("#txtContent").val()),n,i;t=t.replace(/(\n){3,}/ig,"\n\n");var u=$("#Comment_new").html(),r=$("#ReplyToCommentId").html(),f=$("#news_title").html();if(t==""){alert("评论不能为空！");return}if(t.length<3){alert("回复的字数太少了，至少3个字吧！");return}$("#btnComment").val("提交中...").attr("disabled","disabled"),$("#Comment_new").html("评论提交中...").css("color","red").css("margin-left","20px"),$("#Comment_Edit_ID").val()==null||$("#Comment_Edit_ID").val()==""?(n={},n.ContentID=ContentID,n.Content=t,n.strComment=u,n.parentCommentId=r,n.title=f,$.ajax({url:"/mvcajax/news/InsertComment",data:JSON.stringify(n),type:"post",dataType:"text",contentType:"application/json; charset=utf8",success:function(n){comment_callback(n)},error:function(n){alert("出现异常："+n)}})):(i={},i.ContentID=ContentID,i.CommentID=$("#Comment_Edit_ID").val(),i.Content=t,$.ajax({url:"/mvcajax/news/UpdateComment",data:JSON.stringify(i),type:"post",dataType:"text",contentType:"application/json; charset=utf8",success:function(n){comment_edit_callback(n),$("#Comment_Edit_ID").val(""),$("#btnComment").val("提交评论")},error:function(n){alert("出现异常："+n)}}))}function GetNewsComment(){$.ajax({url:"/mvcajax/news/GetComments",data:'{"nid":'+ContentID+"}",type:"post",dataType:"text",contentType:"application/json; charset=utf8",beforeSend:function(){$("#comment_main_list").html("努力加载评论中...")},success:function(n){$(".user_comment").remove(),$("#Comment_new").empty(),$("#comment_main_list").html(n)},error:function(){$("#comment_main_list").html("不好意思！评论加载失败！")}})}function loadCommentForm(){$.ajax({url:"/mvcajax/news/LoadCommentForm",data:"{}",type:"post",dataType:"text",contentType:"application/json; charset=utf8",success:function(n){$("#comment_form_block").html(n)},error:function(n){$("#comment_form_block").html("出现异常："+n)}})}function GetAdminLink(){$.ajax({url:"/mvcajax/news/AdminLink",data:'{"ContentID":'+ContentID+"}",type:"post",dataType:"text",contentType:"application/json; charset=utf8",success:function(n){$("#side_right_search").after(n)}})}function QueryString(n){var u=document.location.search,f,r,t,i;return u!=null?(f=n+"=",r=u.indexOf(f),r!=-1?(t=u.substring(r+f.length),i=t.indexOf("&"),i!=-1?t.substring(0,i):t):null):null}function NewsLoad(){QueryString("listorder")!=null&&(document.getElementById("selectCommentOrder").options[QueryString("listorder")].selected=!0)}function ctlent2(n){n.ctrlKey&&n.keyCode==13&&doComment()}function comment_callback(n){if($("#Comment_new").html(n.replace(/\n/g,"<br/>")),n.indexOf('<span style="color:red">')<0&&$("#txtContent").val(""),$("#com_count").length>0){var t=parseInt($.trim($("#com_count").text()),10);$("#com_count").text(t+1)}$("#ReplyToCommentId").html("0"),comment_btn_reset()}function comment_edit_callback(n){$("#Comment_new").html(n),$("#txtContent").val(""),comment_btn_reset()}function comment_btn_reset(){$("#btnComment").removeAttr("disabled"),$("#btnComment").val("提交评论")}function DiggNews(n){$.ajax({url:"/mvcajax/news/DiggNews",data:'{"NewsID":'+n+"}",type:"post",dataType:"text",contentType:"application/json; charset=utf8",success:function(n){DiggNews_CallBack(n)},error:function(n){alert("出现异常："+n)}})}function DiggNews_CallBack(n){if(n=="-1")alert("您已经推荐过该文章！");else if(n=="-2")alert("您已经反对过该文章！");else{var t=n.split(",");$("#digg_num_"+t[0]).html(t[1])}}function BuryNews(n){$.ajax({url:"/mvcajax/news/BuryNews",data:'{"NewsID":'+n+"}",type:"post",dataType:"text",contentType:"application/json; charset=utf8",success:function(n){BuryNews_CallBack(n)},error:function(n){alert("出现异常："+n)}})}function BuryNews_CallBack(n){if(n=="-1")alert("您已经推荐过该文章！");else if(n=="-2")alert("您已经反对过该文章！");else{var t=n.split(",");$("#bury_num_"+t[0]).html(t[1])}}function ReplyVoteInComment(n,t){news_Comment.PageReplyVote(n,t,ReplyVote_callback)}function ReplyVote(n,t){$.ajax({url:"/mvcajax/news/PageReplyVote",data:'{"CommentID":'+n+',"Action":"'+t+'"}',type:"post",dataType:"text",contentType:"application/json; charset=utf8",success:function(n){ReplyVote_callback(n)},error:function(n){alert("出现异常："+n)}})}function ReplyVote_callback(n){var r=n.split(","),t=r[0],u=r[1],i=r[2];u=="agree"?i==0?$("#tips_"+t).html("<div class=WarningTips>你已经投过票了！</div>"):($("#agree_"+t).html(i),$("#tips_"+t).html("<div class=CompleteTips>谢谢你的参与！</div>")):u=="anti"?i==0?$("#tips_"+t).html("<div class=WarningTips>你已经投过票了！</div>"):($("#anti_"+t).html(i),$("#tips_"+t).html("<div class=CompleteTips>谢谢你的参与！</div>")):u=="report"&&(i==0?$("#tips_"+t).html("<div class=WarningTips>感谢你的举报！</div>"):$("#tips_"+t).html("<div class=CompleteTips>感谢你的举报，我们会尽快处理！</div>")),setTimeout("HideMsg("+t+");",3e3)}function HideMsg(n){$("#tips_"+n).html("")}function HotReplyVote(n,t){PageClass.PageReplyVote(n,t,HotReplyVote_callback)}function HotReplyVote_callback(n){var r=n.value.split(","),t=r[0],u=r[1],i=r[2];u=="agree"?i==0?$("#hot_tips_"+t).html("<div class=WarningTips>你已经投过票了！</div>"):($("#hot_agree_"+t).html(i),$("#hot_tips_"+t).html("<div class=CompleteTips>谢谢你的参与！</div>")):u=="anti"?i==0?$("#hot_tips_"+t).html("<div class=WarningTips>你已经投过票了！</div>"):($("#hot_anti_"+t).html(i),$("#hot_tips_"+t).html("<div class=CompleteTips>谢谢你的参与！</div>")):u=="report"&&(i==0?$("#hot_tips_"+t).html("<div class=WarningTips>感谢你的举报！</div>"):$("#hot_tips_"+t).html("<div class=CompleteTips>感谢你的举报，我们会尽快处理！</div>")),setTimeout("HideMsg2("+t+");",3e3)}function HideMsg2(n){$("#hot_tips_"+n).html("")}function DelComment(n){var t=confirm("你确认删除该评论么？");t&&$.ajax({url:"/mvcajax/news/DelComment",data:'{"CodeID":"'+n+'","ContentID":'+ContentID+"}",type:"post",dataType:"text",contentType:"application/json; charset=utf8",success:function(n){if($("#span_"+n).css("display","none"),$("#com_count").length>0){var t=parseInt($.trim($("#com_count").text()),10);$("#com_count").text(t>0?t-1:0)}},error:function(n){alert("出现异常："+n)}});return}function SetAuthor(n){$("#txtContent").removeClass("txtContent_bg"),$("#ReplyToCommentId").html(n);var t=$("#comment_author_"+n).html();return document.getElementById("txtContent").focus(),document.getElementById("txtContent").value="@"+t+"\n"+document.getElementById("txtContent").value,!1}function QuoteComment(n){var t,i;SetAuthor(n),t=$("#comment_body_"+n).html(),t=t.replace(/<br>|<br\/>/ig,"\n"),t=t.replace(/<fieldset\sclass=\"comment_quote\"><legend>引用<\/legend>/ig,"[quote]"),t=t.replace(/<\/fieldset>/ig,"[/quote]"),t=t.replace(/<[^>]*>/g,""),t=jQuery.trim(t),t.length>200&&(t=t.substring(0,200)+"..."),$("#txtContent").focus(),i=$("#txtContent").val(),i=i.replace(/^\n/g,""),$("#txtContent").val(i+"[quote]"+t+"[/quote]\n")}function SetCommentEdit(n){$("#Comment_Edit_ID").val(n),$.ajax({url:"/mvcajax/news/GetComment",data:'{"CodeID":"'+n+'"}',type:"post",dataType:"text",contentType:"application/json; charset=utf8",success:function(n){$("#txtContent").val(n),$("#txtContent").focus(),$("#btnComment").val("修改评论")},error:function(n){alert("出现异常："+n)}})}function recommend(n){$.ajax({url:"/service/NewsService.asmx/SetRecommend",data:'{contentId:"'+n+'"}',type:"post",dataType:"json",contentType:"application/json; charset=utf-8",cache:!1,success:function(n){n.d?($("#opt_recommend").css("color","red"),$("#opt_recommend").html("推荐成功")):($("#opt_recommend").css("color","red"),$("#opt_recommend").html("推荐失败"))},error:function(n){alert(n.responseText)}})}function cancel_recommend(n){$.ajax({url:"/service/NewsService.asmx/CancelRecommend",data:'{contentId:"'+n+'"}',type:"post",dataType:"json",contentType:"application/json; charset=utf-8",cache:!1,success:function(n){n.d?($("#opt_recommend").css("color","red"),$("#opt_recommend").html("取消推荐成功")):($("#opt_recommend").css("color","red"),$("#opt_recommend").html("取消推荐失败"))},error:function(n){alert(n.responseText)}})}function hide_news(n){$.ajax({url:"/mvcajax/news/HideNews",data:'{"ContentID":'+n+"}",type:"post",dataType:"text",contentType:"application/json; charset=utf8",success:function(){location.reload()},error:function(n){alert("出现异常："+n)}})}function publish_news(n){$.ajax({url:"/mvcajax/news/SetPublishStatus",data:'{"ContentID":'+n+"}",type:"post",dataType:"text",contentType:"application/json; charset=utf8",success:function(){location.reload()},error:function(n){alert("出现异常："+n)}})}function PutInWz(){var i=460,r=353,u=(screen.width-i)/2,f=(screen.height-r)/2,n=document,t=n.selection?n.selection.type!="None"?n.selection.createRange().text:"":n.getSelection?n.getSelection():"";t.length>200&&(t=t.substring(0,200)+"..."),window.open("http://wz.cnblogs.com/create?t="+encodeURIComponent(n.title)+"&u="+encodeURIComponent(n.location.href)+"&c="+encodeURIComponent(t)+"&i=0","_blank","width="+i+",height="+r+",toolbars=0,resizable=1,left="+u+",top="+f)}function go_link(n){window.location=n}function LogShareClick(n){PageClass.LogShareClick(n)}function ToTsina(){var i=$("#news_title a").html(),t="http://news.cnblogs.com/n/"+ContentID+"/",n="#IT新闻# "+i+"，"+t;$.ajax({url:"/service/NewsService.asmx/ToTsina",data:"{content:'"+n+"'}",type:"post",dataType:"json",contentType:"application/json; charset=utf-8",cache:!1,success:function(n){n.d?($("#opt_tsina").css("color","red"),$("#opt_tsina").html("发布成功")):($("#opt_tsina").css("color","red"),$("#opt_tsina").html("发布失败"))},error:function(n){alert(n.responseText)}})}function audit(n,t){ajaxRequest.url="/service/NewsService.asmx/AuditById",ajaxRequest.data="{newsId:"+n+",auditType:"+t+"}",ajaxRequest.success=function(){$("#span_audit_"+t).css("color","red"),$("#span_audit_"+t).html($("#lnk_audit_"+t).html()+"成功")},$.ajax(ajaxRequest)}function GetRecommendJobList(){$.ajax({url:"/service/NewsService.asmx/GetRecommendJobList",data:"{}",type:"post",dataType:"json",contentType:"application/json; charset=utf-8",cache:!1,success:function(n){n.d&&($("#job_recommend_list").html(n.d),$("#job_recommend").show())}})}function log(){var n=ContentID;$.ajax({url:"/service/NewsService.asmx/UpdateViewCount",data:'{"id":'+n+"}",type:"post",dataType:"json",contentType:"application/json; charset=utf-8",cache:!1,success:function(){}})}function google_cse_load(){var t=document.createElement("script"),n;t.type="text/javascript",t.src="http://www.google.com.hk/coop/cse/brand?form=cse-search-box&amp;lang=zh-Hans",n=document.getElementById("google_cse_holder"),n.parentNode.insertBefore(t,n)}function get_share_links(){var n,t;try{n=$("#news_title").html(),n=n.replace(/\"/g,'\\"'),t=location.href,$.ajax({url:"/service/NewsService.asmx/GetShareLinks",data:'{title:"'+n+'",url:"'+t+'"}',type:"post",dataType:"json",contentType:"application/json; charset=utf-8",cache:!1,success:function(n){$("#sharebox").append(n.d)},error:function(){}})}catch(i){}}function tsina_a(){var r=screen,u=document,f=encodeURIComponent,n="http://v.t.sina.com.cn/share/share.php?",t=u.location.href,i=["url=",f(t),"&title=",f(u.title.replace("_IT新闻_博客园","")),"&appkey=2924220432"].join("");window.open([n,i].join(""),"mb",["toolbar=0,status=0,resizable=1,width=620,height=450,left=",(r.width-620)/2,",top=",(r.height-450)/2].join(""))||(t.href=[n,i].join(""))}function tqq_a(){var r=screen,u=document,f=encodeURIComponent,n="http://v.t.qq.com/share/share.php?",t=u.location.href,i=["url=",f(t),"&title=",f(u.title.replace("_IT新闻_博客园","")),"&appkey=caffbb4e48c14ec1aa159cf61470d76a"].join("");window.open([n,i].join(""),"mb",["toolbar=0,status=0,resizable=1,width=620,height=450,left=",(r.width-620)/2,",top=",(r.height-450)/2].join(""))||(t.href=[n,i].join(""))}function tsohu_a(){var f=screen,u=document,n=encodeURIComponent,e="utf-8",i="http://t.sohu.com/third/post.jsp?",r=u.location.href,t=["&url=",n(r),"&title=",n(u.title.replace("_IT新闻_博客园","")),"&content=",e||"gb2312","&pic=",n(t||"")].join("");window.open([i,t].join(""),"mb",["toolbar=0,status=0,resizable=1,width=660,height=470,left=",(f.width-660)/2,",top=",(f.height-470)/2].join(""))||(r.href=[i,t].join(""))}function ShareToTsina(){/Firefox/.test(navigator.userAgent)?setTimeout(tsina_a,0):tsina_a()}function ShareToTqq(){/Firefox/.test(navigator.userAgent)?setTimeout(tqq_a,0):tqq_a()}function ShareToTsohu(){/Firefox/.test(navigator.userAgent)?setTimeout(tsohu_a,0):tsohu_a()}function ask(n){n!=""&&window.open("http://v.t.sina.com.cn/share/share.php?searchPic=false&title="+decodeURIComponent(n)+"&url="+location.href+"&source=博客园&sourceUrl=http://news.cnblogs.com&content=utf-8&appkey=2970785141","_blank","height=515, width=598, toolbar=no, menubar=no, scrollbars=auto, resizable=yes, location=no, status=yes")}